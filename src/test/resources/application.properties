# Test configuration
quarkus.application.name=module-registry-service-test

# Avoid HTTP port conflicts in tests
quarkus.http.test-port=0
quarkus.http.port=0

# Database for tests (MySQL DevServices)
quarkus.datasource.db-kind=mysql
quarkus.datasource.devservices.enabled=true
quarkus.datasource.devservices.image-name=mysql:8.0
quarkus.datasource.devservices.port=0
quarkus.datasource.devservices.show-logs=true
quarkus.datasource.devservices.reuse=false
quarkus.datasource.devservices.container-env.MYSQL_DATABASE=pipeline_registry_test
# Ensure credentials align with DevServices defaults
quarkus.datasource.username=quarkus
quarkus.datasource.password=quarkus

# Use Flyway for tests to create schema
quarkus.hibernate-orm.schema-management.strategy=none
quarkus.flyway.migrate-at-start=true

# Enable Consul for tests (will be mocked)
pipeline.consul.enabled=true

# Messaging disabled in tests to avoid Kafka dependency
# Disable outgoing channels in tests to avoid Kafka dependency
%test.mp.messaging.outgoing.opensearch-service-registered-events.enabled=false
%test.mp.messaging.outgoing.opensearch-service-unregistered-events.enabled=false
%test.mp.messaging.outgoing.opensearch-module-registered-events.enabled=false
%test.mp.messaging.outgoing.opensearch-module-unregistered-events.enabled=false
# Also force Kafka bootstrap to a no-op address (in case any Kafka config is still evaluated)
kafka.bootstrap.servers=localhost:0
%test.mp.messaging.connector.smallrye-kafka.bootstrap.servers=${kafka.bootstrap.servers}

# Logging
quarkus.log.level=INFO
quarkus.log.category."ai.pipestream.registry".level=DEBUG